var tempUnit="c",address,woeid;$(document).ready(function(){function e(e,t,a){i(e),$("#weatherReport").empty(),$("#weatherReport").weatherfeed([t],{unit:a,woeid:!0}),$("#weatherList").empty(),s()}function t(t){now=new Date;var i='select * from geo.placefinder where text="'+t.coords.latitude+","+t.coords.longitude+'" and gflags="R"',a="http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent(i)+"&rnd="+now.getFullYear()+now.getMonth()+now.getDay()+now.getHours()+"&format=json&callback=?";$.ajax({type:"GET",url:a,dataType:"json",success:function(t){t.query.count>0&&(woeid=t.query.results.Result.woeid,e(address,woeid,tempUnit))},error:function(){}})}function i(e){$("#bgrpic").css("background-image","url('background.jpg')"),$(".weather").css("background-image","url('background.jpg')");var t,i="https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=318f0c009c9aee06e5a817bb0278d56e&tags="+e+"&per_page=1&group_id=1074553@N22";$.getJSON(i+"&format=json&jsoncallback=?",function(e){$.each(e.photos.photo,function(e,i){t="http://farm"+i.farm+".static.flickr.com/"+i.server+"/"+i.id+"_"+i.secret+".jpg",$("#bgrpic").css("background-image","url('"+t+"')"),$(".weather").css("background-image","url('"+t+"')")})})}function a(t,i){var a="",t=document.getElementById(t).value,i=document.getElementById(i);if(t){i.innerHTML="",now=new Date;var r='select * from geo.places where text="'+t+'"',n="http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent(r)+"&rnd="+now.getFullYear()+now.getMonth()+now.getDay()+now.getHours()+"&format=json&callback=?";$.ajax({type:"GET",url:n,dataType:"json",success:function(t){if(t.query.count>0){if(t.query.count>1&&(a=a),a+="<ul>",t.query.count>1)for(var r=0;r<t.query.count;r++)a=a+"<li>"+o(t.query.results.place[r])+"</li>";else a=a+"<li>"+o(t.query.results.place)+"</li>";a+="</ul>",i.innerHTML=a,$("a.weatherAddress").unbind("click"),$("a.weatherAddress").click(function(t){t.preventDefault(),address=$(this).text(),woeid=$(this).attr("rel"),e(address,woeid,tempUnit)})}else i.innerHTML="The location could not be found"},error:function(){i.innerHTML="An error has occurred"}})}else i.innerHTML="Please enter a location or partial address"}function o(e){var t=e.name;e.admin2&&(t+=", "+e.admin2.content),e.admin1&&(t+=", "+e.admin1.content),t+=", "+e.country.content;var i=e.woeid;return'<a class="weatherAddress" href="#" rel="'+i+'" title="Click for to see a weather report">'+t+"</a> "}function s(){$.fn.weatherfeed=function(t,i,a){var o={unit:"c",image:!0,country:!1,highlow:!0,wind:!1,humidity:!1,visibility:!1,sunrise:!1,sunset:!1,forecast:!0,forecastdays:3,link:!0,showerror:!0,linktarget:"_self",woeid:!0,refresh:0},i=$.extend(o,i),s="odd";return this.each(function(o,c){function l(e,t,i){s="odd",u.html(""),$.ajax({type:"GET",url:t,dataType:"json",success:function(e){if(e.query){if(e.query.results.channel.length>0)for(var t=e.query.results.channel.length,r=0;t>r;r++)f(c,e.query.results.channel[r],i);else f(c,e.query.results.channel,i);$.isFunction(a)&&a.call(this,u)}else i.showerror&&u.html("<p>Weather information unavailable</p>")},error:function(){i.showerror&&u.html("<p>Weather request failed</p>")}})}var u=$(c);if(u.hasClass("weatherFeed")||u.addClass("weatherFeed"),!$.isArray(t))return!1;var h=t.length;h>10&&(h=10);for(var g="",o=0;h>o;o++)""!=g&&(g+=","),g+="'"+t[o]+"'";now=new Date;var v=i.woeid?"woeid":"location",p="select * from weather.forecast where "+v+" in ("+g+") and u='"+i.unit+"'",w="http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent(p)+"&rnd="+now.getFullYear()+now.getMonth()+now.getDay()+now.getHours()+"&format=json&callback=?";if(l(p,w,i),i.refresh>0){setInterval(function(){l(p,w,i)},6e4*i.refresh)}var f=function(t,i,a){function r(){var e=document.getElementById("canvas").getContext("2d");window.myLine=new Chart(e).Line(h,{responsive:!1})}var o=$(t);if("Yahoo! Weather Error"!=i.description){var d=i.wind.direction;d>=348.75&&360>=d&&(d="N"),d>=0&&11.25>d&&(d="N"),d>=11.25&&33.75>d&&(d="NNE"),d>=33.75&&56.25>d&&(d="NE"),d>=56.25&&78.75>d&&(d="ENE"),d>=78.75&&101.25>d&&(d="E"),d>=101.25&&123.75>d&&(d="ESE"),d>=123.75&&146.25>d&&(d="SE"),d>=146.25&&168.75>d&&(d="SSE"),d>=168.75&&191.25>d&&(d="S"),d>=191.25&&213.75>d&&(d="SSW"),d>=213.75&&236.25>d&&(d="SW"),d>=236.25&&258.75>d&&(d="WSW"),d>=258.75&&281.25>d&&(d="W"),d>=281.25&&303.75>d&&(d="WNW"),d>=303.75&&326.25>d&&(d="NW"),d>=326.25&&348.75>d&&(d="NNW");var c=i.item.forecast[0];wpd=i.item.pubDate,n=wpd.indexOf(":"),tpb=y(wpd.substr(n-2,8)),tsr=y(i.astronomy.sunrise),tss=y(i.astronomy.sunset),daynight=tpb>tsr&&tpb<tss?"day":"night";var l='<div class="weatherItem '+s+" "+daynight+'"';a.image&&(l+=' style="background-image: url(icons/icons_white/'+i.item.condition.code.substring(0,2)+daynight.substring(0,1)+'.png); background-repeat: no-repeat; background-position: 60px 20px;"'),l+=">",l+='<div class="current_weather"><div class="gradbgr"></div><div id="curr_cond"><div class="tablecell"><div class="weatherDesc">'+i.item.condition.text+"</div>",a.highlow&&(l+='<div class="weatherRange">High: '+c.high+"&deg; <br> Low: "+c.low+"&deg;</div>"),a.wind&&(l+='<div class="weatherWind">Wind: '+d+" "+i.wind.speed+i.units.speed+"</div>"),a.humidity&&(l+='<div class="weatherHumidity">Humidity: '+i.atmosphere.humidity+"</div>"),a.visibility&&(l+='<div class="weatherVisibility">Visibility: '+i.atmosphere.visibility+"</div>"),a.sunrise&&(l+='<div class="weatherSunrise">Sunrise: '+i.astronomy.sunrise+"</div>"),a.sunset&&(l+='<div class="weatherSunset">Sunset: '+i.astronomy.sunset+"</div>"),l+="</div></div>",l+='<div id="curr_location"><div class="tablecell"><div class="weatherCity">'+i.location.city+", "+i.location.country+"</div>";var u=i.item.forecast;l+='<div class="weatherForecastDay">'+u[0].day+", "+u[0].date+"</div></div></div></div>",l+='<div class="weatherRight">',l+='<div class="weatherTemp">'+i.item.condition.temp+"&deg;</div>",l+='<div id="linechart"><canvas id="canvas" style="width: 209px; height: 100px;"></canvas></div>';var h={labels:[u[0].day,u[1].day,u[2].day,u[3].day,u[4].day],datasets:[{label:"My First dataset",fillColor:"rgba(255,255,255,1)",strokeColor:"rgba(131,45,52,1)",pointColor:"rgba(131,45,52,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(220,220,220,1)",data:[u[0].high,u[1].high,u[2].high,u[3].high,u[4].high]}]};if(a.forecast){l+='<div class="weatherForecast">';var u=i.item.forecast,g=a.forecastdays;g>u.length&&(g=u.length);for(var v=1;g>=v;v++)l+='<div class="weatherForecastItem day'+(v+1)+'" style="background-image: url(icons/icons_red/'+u[v].code+'d.png); background-repeat: no-repeat; background-size: auto 40px; background-position: center top;">',l+='<div class="weatherForecastDay">'+u[v].day+"</div>",l+='<div class="weatherForecastRange">'+u[v].high+' <br> <span class="darktxt">'+u[v].low+"</span></div>",l+="</div>";l+='<div style="clear:both"></div></div><div id="settings"><input id="settings_btn" type="button" name="answer" /></div><div id="settings_container">Temperature: <a href="#" id="cels">Celisius</a> | <a href="#" id="fahr">Fahrenheit</a></div>'}l+="</div>"}else{var l='<div class="weatherItem '+s+'">';l+='<div class="weatherError">City not found</div>'}l+="</div>",s="odd"==s?"even":"odd",o.append(l),r(),$("#settings_btn").click(function(){$("#settings_container").toggle(400)}),document.getElementById("fahr").onclick=function(){tempUnit="f",e(address,woeid,tempUnit)},document.getElementById("cels").onclick=function(){tempUnit="c",e(address,woeid,tempUnit)}},y=function(e){return d=new Date,r=new Date(d.toDateString()+" "+e),r}})}}navigator.geolocation&&navigator.geolocation.getCurrentPosition(t),s(),$("#search").submit(function(e){e.preventDefault(),a("weatherLocation","weatherList")})});